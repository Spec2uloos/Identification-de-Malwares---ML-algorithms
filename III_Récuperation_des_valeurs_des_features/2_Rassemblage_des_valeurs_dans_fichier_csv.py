import csv
from socket import SocketKind
import psutil

def save_net_connections_to_csv(file_path):
    # Get the net connections
    net_connections = psutil.net_connections()

    # Define the CSV file headers
    #headers = ['fd', 'family', 'type', 'laddr', 'raddr', 'status', 'pid']
    headers = ['protocol_type', 'service', 'flag', 'src_bytes', 'dst_bytes',
       'logged_in', 'count', 'srv_count', 'serror_rate', 'srv_serror_rate',
       'rerror_rate', 'srv_rerror_rate', 'same_srv_rate', 'diff_srv_rate',
       'srv_diff_host_rate', 'dst_host_count', 'dst_host_srv_count',
       'dst_host_same_srv_rate', 'dst_host_diff_srv_rate',
       'dst_host_same_src_port_rate', 'dst_host_srv_diff_host_rate',
       'dst_host_serror_rate', 'dst_host_srv_serror_rate',
       'dst_host_rerror_rate', 'dst_host_srv_rerror_rate']
    

    # Open the CSV file
    with open(file_path, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
    
        # Write the headers to the CSV file
        writer.writerow(headers)

        # Write each net connection to the CSV file
        for conn in net_connections:
            
            writer.writerow([
                conn.type.value , 
                conn.laddr,
                conn.raddr, 
                conn.status, 
                conn.pid
            ])

# Specify the file path where you want to save the CSV file
csv_file_path = './net_connections.csv'

# Call the function to save net connections to the CSV file
save_net_connections_to_csv(csv_file_path)
